This article explains how to use Dynamo to quickly setup a new Ada
project, design the data model of the application, generate the Ada
model files, build the database and use the Ada Database Objects
library to populate the database using the data model.

The article assumes that you have installed Dynamo, the ArgoUML
application.

## Setting up ArgoUML to use Dynamo UML profiles ##

Before anything, you should setup ArgoUML to use the Dynamo UML
profile.  This step must be done only once for your ArgoUML application.
Dynamo provides a UML profile which contains stereotypes and data types
that are used for the data modeling of your database.  It is necessary
to tell ArgoUML where the Dynamo UML profile is located.

To know where the Dynamo UML profile is installed, run the following
command:

```
dynamo -v
```

After starting ArgoUML, go in **Settings** => **Profiles** and add
the UML directory in the list of directories that ArgoUML looks for the UML profiles.  These steps are described in the following video:

<a href='http://www.youtube.com/watch?feature=player_embedded&v=M25eAm3Mly8' target='_blank'><img src='http://img.youtube.com/vi/M25eAm3Mly8/0.jpg' width='425' height=344 /></a>

## Creating an Ada database application using Dynamo and Eclipse ##

Dynamo contains a **create-project** command that you can use to
quickly setup a new Ada project.  Two project templates are defined:

  * An ADO template intended to be used for general purpose database applications.
  * An Ada Web Application template targeted as a more complete application with database access and web pages.

This article focuses on the Ada database application template.
To use the **create-project** command, you will have to give a project name.  It will be used as the main Ada package name.  You should also specify you name or email address so that file headers are customized accordingly.  You may also choose the license you want to use for the project.

The command to generate the demo application presented in the video is:

```
dynamo create-project --ado demo Iorek.Byrnison@svalbard.com
```

After creating your project, you should run the `configure` script
to setup the project and get the GNAT project files configured.

```
./configure
```

<a href='http://www.youtube.com/watch?feature=player_embedded&v=MvMUl1QGvB4' target='_blank'><img src='http://img.youtube.com/vi/MvMUl1QGvB4/0.jpg' width='425' height=344 /></a>

## Database Modeling with ArgoUML for Ada applications ##

The database modeling support of Dynamo allows you to design your
data model by using an UML tool such are ArgoUML and let Dynamo build
the Ada packages that correspond to your UML model.  The Ada generated files should not be modified, they are generated in a separate directory (`src/model`) to reduce confusion.

  * The data model should be put in a specific package, preferably child of the some application package.  The package must be assigned the **DataModel** stereotype (defined in the Dynamo UML profile).  The stereotype controls the activation of the Ada code generation for UML classes defined in the package.
  * A database table is represented by a UML class that is assigned the **Table** stereotype.
  * Table columns are represented by UML class attributes or some types of associations.  The primary key attribute should be associated with the **PK** (PrimaryKey) stereotype.

Once the UML model is created and saved, the Dynamo **generate** command can be used.  It should be executed each time the UML model is modified.
It will generate the Ada model files as well as the SQL schema files.
The tool is able to read ArgoUML files directly.

```
dynamo generate db demo.zargo
```

Once the SQL files are generated, you can also use Dynamo to create the
MySQL database.

```
dynamo create-database db 'mysql://localhost:3306/demo?user=demo' root 
```

The video below describes all these steps through the design of
a simple question and answer UML model.

<a href='http://www.youtube.com/watch?feature=player_embedded&v=5q542_gVDd0' target='_blank'><img src='http://img.youtube.com/vi/5q542_gVDd0/0.jpg' width='425' height=344 /></a>

## Using the Ada and database model generated by Dynamo ##

Once we have the Ada model files, we can use them to populate the
database in the application.  Let's create a question in the database.
You must first define the question object.  The UML class `Question`
is mapped to the Ada tagged record `Question_Ref` which represents
a database object with specific attributes and operations that depend on your model.

```
   Question : Demo.Models.Question_Ref;
```

For each UML class attribute, Dynamo has create at least one function
and one procedure to get and set the attribute.  To fill the question,
we just need to call the **Set\_XXX** procedures.  A **Save** operation
was also generated and it allows to save the instance by either inserting it in the database or updating the attributes that were modified.

```
   DB.Begin_Transaction;
   Question.Set_Title ("How can we build an application?");
   Question.Set_Author ("Iorek");
   Question.Set_Text ("I need to build this Ada application. "
                        & "How should I do this?");
   Question.Set_Create_Date (Ada.Calendar.Clock);
   Question.Save (DB);
   DB.Commit;
```

The **Save** operation should be called within the context of a database
transaction.

To create the answer, let's create the answer instance:
```
   Answer   : Demo.Models.Answer_Ref;
```

The answer is associated with the question by using the
`Set_Question` procedure.  This correspond to the UML association end
which comes from the **Answer** to the **Question** class.


```
   --  Create an answer (in a separate transaction for the demo).
   DB.Begin_Transaction;
   Answer.Set_Question (Question);
   Answer.Set_Author ("Lyra");
   Answer.Set_Text ("You can use 'gnatmake -Pdemo' to build");
   Answer.Save (DB);
   DB.Commit;
```

You will build the project as follows:

```
make
```

<a href='http://www.youtube.com/watch?feature=player_embedded&v=a8V9Om438wA' target='_blank'><img src='http://img.youtube.com/vi/a8V9Om438wA/0.jpg' width='425' height=344 /></a>

You may download the files at http://code.google.com/p/ada-gen/downloads/list